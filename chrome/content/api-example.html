<html>
<head>
  <title>Forecastfox API Example Usage</title>
  <script type="text/javascript" src="chrome://forecastfox/content/forecastfox.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
  <script type="text/javascript">
    // Get the API class
    var api = Forecastfox.api();

    // register event listener for when new data is ready
    api.events.dataReady.addEventListener(render_wx);

    // add event listener for when the data starts updating
    api.events.updateStart.addEventListener(on_start);     

    // add event listener for when there's an error 
    api.events.updateError.addEventListener(on_error);
    
    function on_start() { 
      // display the throbber when the feed is updating
      $('.throbber').show(); 
    }
    
    function on_error() { 
      // display an error message when it fails
      $('.throbber').hide();
      $('.error').show(); 
    }

    function render_wx() {
      $('.throbber').hide();
      $('.error').hide();

      // get the latest data
      var data = api.data.all();

      var cc = data.cc;                     // gets the current conditions data
      var today = data.forecast[0]['day'];  // gets the forecast for day 0 (today) and the 'day' (vs 'night')
      var location = data.location;         // gets location information

      $('#location').text(location.name).attr('href', cc.links.day5);
      $('#cc').html('Now: <img src="' + api.images.small(cc.icon) +'"/> ' + cc.temperature);
      $('#f1').html('Today: <img src="' + api.images.small(today.icon) + '"/> ' + today.temperature.high);
    }
    
    $( function() {
      render_wx();

      // open the forecast when someone clicks the widget
      $('#inner-widget').click(function() { Forecastfox.open($('#location').attr('href')); });

      // open the options when someone clicks the customization link
      $('.options').click(function() { Forecastfox.customize(); });

      $(window).unload(function() {
        // unregister event listeners on page unload
        api.events.dataReady.removeEventListener(render_wx);
        api.events.updateStart.removeEventListener(on_start);      
        api.events.updateError.removeEventListener(on_error);
      });
    });
    
  </script>
  <style>
    hidden { display: none; }
    .error { color: red; font-weight: bold; }
    #widget { float: left; }
    #inner-widget { 
      border: 1px solid black; 
      -moz-border-radius: 5px;
      padding: 5px;
      cursor: pointer;
    }
    
    #inner-widget:hover { background-color: #dfdfdf; }
    .options { 
      font-size: 70%; 
      color: blue; 
      text-decoration: underline; 
      float: right;
      cursor: pointer;
    }
    
    #location { font-weight: bold; }
  </style>
</head>
<body>
<h1>Forecastfox API Sample Usage</h1>

<p>The following is a basic weather widget...</p>

<div id="widget">
  <div id="inner-widget">
    <div class="error hidden">!!! error fetching data</div>
    <div>
      <span id="location" href=""></span>
      <img class="throbber hidden" src="chrome://global/skin/icons/loading_16.png"></img>
    </div>
    <div id="cc"></div>
    <div id="f1"></div>
  </div>
  <span class="options">options</span>
</div>


</body>
</html>